<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birthday Reminder App</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide icons as React components
        const Calendar = ({ size = 24, color = "currentColor", strokeWidth = 2 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const Send = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );

        const Edit3 = ({ size = 24, color = "currentColor" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 20h9"></path>
                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
            </svg>
        );

        const Sparkles = ({ size = 24, color = "currentColor", className = "" }) => (
            <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
                <path d="M5 3v4"></path>
                <path d="M19 17v4"></path>
                <path d="M3 5h4"></path>
                <path d="M17 19h4"></path>
            </svg>
        );

        const BirthdayReminderApp = () => {
            const [clients, setClients] = useState([]);
            const [todaysBirthdays, setTodaysBirthdays] = useState([]);
            const [messages, setMessages] = useState({});
            const [editingId, setEditingId] = useState(null);
            const [loading, setLoading] = useState({});
            const [apiKey, setApiKey] = useState('');
            const [showSettings, setShowSettings] = useState(false);

            // Load API key from localStorage
            useEffect(() => {
                const savedKey = localStorage.getItem('anthropic_api_key');
                if (savedKey) setApiKey(savedKey);
            }, []);

            // Check for today's birthdays
            const checkBirthdays = () => {
                const today = new Date();
                const todayMonth = today.getMonth() + 1;
                const todayDay = today.getDate();

                const birthdaysToday = clients.filter(client => {
                    const dob = new Date(client.dateOfBirth);
                    return dob.getMonth() + 1 === todayMonth && dob.getDate() === todayDay;
                });

                setTodaysBirthdays(birthdaysToday);
                
                // Generate messages for each birthday
                birthdaysToday.forEach(client => {
                    if (!messages[client.id]) {
                        generateMessage(client);
                    }
                });
            };

            // Generate AI message for a client
            const generateMessage = async (client) => {
                if (!apiKey) {
                    alert('Please set your Anthropic API key in settings');
                    return;
                }

                setLoading(prev => ({ ...prev, [client.id]: true }));

                try {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': apiKey,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 300,
                            messages: [{
                                role: 'user',
                                content: `Generate a warm, personalized birthday text message for my client named ${client.name}. 
                                Make it professional but friendly, brief (2-3 sentences), and sincere. 
                                Don't use emojis or overly casual language. 
                                Don't include a signature or sign-off.
                                Just write the message text itself.`
                            }]
                        })
                    });

                    const data = await response.json();
                    const generatedMessage = data.content[0].text;

                    setMessages(prev => ({
                        ...prev,
                        [client.id]: generatedMessage
                    }));
                } catch (error) {
                    console.error('Error generating message:', error);
                    alert('Failed to generate message. Please check your API key.');
                } finally {
                    setLoading(prev => ({ ...prev, [client.id]: false }));
                }
            };

            // Handle message editing
            const handleEditMessage = (clientId, newMessage) => {
                setMessages(prev => ({
                    ...prev,
                    [clientId]: newMessage
                }));
            };

            // Send message (in reality, this would integrate with SMS)
            const handleSendMessage = (client) => {
                const message = messages[client.id];
                const smsUrl = `sms:${client.phoneNumber}&body=${encodeURIComponent(message)}`;
                window.location.href = smsUrl;
                
                // Mark as sent
                setTimeout(() => {
                    setTodaysBirthdays(prev => prev.filter(c => c.id !== client.id));
                }, 1000);
            };

            // Save API key
            const saveApiKey = () => {
                localStorage.setItem('anthropic_api_key', apiKey);
                setShowSettings(false);
                alert('API key saved!');
            };

            // Import clients from CSV
            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    const text = e.target.result;
                    const lines = text.split('\n').slice(1); // Skip header
                    
                    const parsedClients = lines
                        .filter(line => line.trim())
                        .map((line, index) => {
                            const [name, phoneNumber, dateOfBirth] = line.split(',').map(s => s.trim());
                            return {
                                id: `client-${index}`,
                                name,
                                phoneNumber,
                                dateOfBirth
                            };
                        });

                    setClients(parsedClients);
                    localStorage.setItem('clients', JSON.stringify(parsedClients));
                    alert(`Loaded ${parsedClients.length} clients!`);
                };
                reader.readAsText(file);
            };

            // Load clients from localStorage
            useEffect(() => {
                const savedClients = localStorage.getItem('clients');
                if (savedClients) {
                    setClients(JSON.parse(savedClients));
                }
            }, []);

            // Check birthdays on mount and when clients change
            useEffect(() => {
                if (clients.length > 0) {
                    checkBirthdays();
                }
            }, [clients]);

            return (
                <div style={{
                    minHeight: '100vh',
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    padding: '2rem',
                    fontFamily: '"SF Pro Display", -apple-system, BlinkMacSystemFont, sans-serif'
                }}>
                    <div style={{
                        maxWidth: '800px',
                        margin: '0 auto'
                    }}>
                        {/* Header */}
                        <div style={{
                            background: 'rgba(255, 255, 255, 0.98)',
                            borderRadius: '24px',
                            padding: '2rem',
                            marginBottom: '2rem',
                            boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)',
                            backdropFilter: 'blur(10px)'
                        }}>
                            <div style={{
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'space-between',
                                marginBottom: '1rem'
                            }}>
                                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                                    <Calendar size={40} color="#667eea" strokeWidth={2.5} />
                                    <h1 style={{
                                        margin: 0,
                                        fontSize: '2rem',
                                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                                        WebkitBackgroundClip: 'text',
                                        WebkitTextFillColor: 'transparent',
                                        fontWeight: '700'
                                    }}>
                                        Birthday Reminder
                                    </h1>
                                </div>
                                <button
                                    onClick={() => setShowSettings(!showSettings)}
                                    style={{
                                        background: '#667eea',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '12px',
                                        padding: '0.75rem 1.5rem',
                                        cursor: 'pointer',
                                        fontWeight: '600',
                                        fontSize: '0.95rem',
                                        transition: 'all 0.2s'
                                    }}
                                >
                                    Settings
                                </button>
                            </div>

                            {/* Settings Panel */}
                            {showSettings && (
                                <div style={{
                                    marginTop: '1.5rem',
                                    padding: '1.5rem',
                                    background: '#f7f9fc',
                                    borderRadius: '16px'
                                }}>
                                    <h3 style={{ marginTop: 0, color: '#333' }}>API Configuration</h3>
                                    <input
                                        type="password"
                                        value={apiKey}
                                        onChange={(e) => setApiKey(e.target.value)}
                                        placeholder="Enter your Anthropic API key"
                                        style={{
                                            width: '100%',
                                            padding: '0.75rem',
                                            borderRadius: '8px',
                                            border: '2px solid #e0e0e0',
                                            fontSize: '0.95rem',
                                            marginBottom: '1rem'
                                        }}
                                    />
                                    <button
                                        onClick={saveApiKey}
                                        style={{
                                            background: '#764ba2',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            padding: '0.75rem 1.5rem',
                                            cursor: 'pointer',
                                            fontWeight: '600'
                                        }}
                                    >
                                        Save API Key
                                    </button>
                                    <p style={{ fontSize: '0.85rem', color: '#666', marginTop: '1rem' }}>
                                        Get your API key from: <a href="https://console.anthropic.com/" target="_blank" style={{ color: '#667eea' }}>console.anthropic.com</a>
                                    </p>
                                </div>
                            )}

                            {/* File Upload */}
                            <div style={{ marginTop: '1.5rem' }}>
                                <label style={{
                                    display: 'block',
                                    marginBottom: '0.5rem',
                                    fontWeight: '600',
                                    color: '#555'
                                }}>
                                    Upload Client Data (CSV)
                                </label>
                                <input
                                    type="file"
                                    accept=".csv"
                                    onChange={handleFileUpload}
                                    style={{
                                        display: 'block',
                                        width: '100%',
                                        padding: '0.75rem',
                                        borderRadius: '12px',
                                        border: '2px dashed #667eea',
                                        cursor: 'pointer'
                                    }}
                                />
                                <p style={{
                                    fontSize: '0.85rem',
                                    color: '#888',
                                    marginTop: '0.5rem',
                                    marginBottom: 0
                                }}>
                                    CSV format: name, phone_number, date_of_birth (YYYY-MM-DD)
                                </p>
                            </div>

                            {clients.length > 0 && (
                                <div style={{
                                    marginTop: '1rem',
                                    padding: '1rem',
                                    background: '#f0f9ff',
                                    borderRadius: '8px',
                                    color: '#0369a1',
                                    fontSize: '0.9rem'
                                }}>
                                    âœ“ {clients.length} clients loaded
                                </div>
                            )}
                        </div>

                        {/* Today's Birthdays */}
                        {todaysBirthdays.length > 0 ? (
                            <div>
                                <h2 style={{
                                    color: 'white',
                                    fontSize: '1.5rem',
                                    marginBottom: '1.5rem',
                                    fontWeight: '600',
                                    textShadow: '0 2px 10px rgba(0, 0, 0, 0.2)'
                                }}>
                                    ðŸŽ‰ Today's Birthdays ({todaysBirthdays.length})
                                </h2>
                                
                                {todaysBirthdays.map(client => (
                                    <div
                                        key={client.id}
                                        style={{
                                            background: 'rgba(255, 255, 255, 0.98)',
                                            borderRadius: '20px',
                                            padding: '2rem',
                                            marginBottom: '1.5rem',
                                            boxShadow: '0 10px 40px rgba(0, 0, 0, 0.2)',
                                            transition: 'transform 0.2s'
                                        }}
                                    >
                                        <div style={{
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'flex-start',
                                            marginBottom: '1rem'
                                        }}>
                                            <div>
                                                <h3 style={{
                                                    margin: 0,
                                                    fontSize: '1.5rem',
                                                    color: '#333',
                                                    fontWeight: '700'
                                                }}>
                                                    {client.name}
                                                </h3>
                                                <p style={{
                                                    margin: '0.25rem 0 0 0',
                                                    color: '#888',
                                                    fontSize: '0.95rem'
                                                }}>
                                                    {client.phoneNumber}
                                                </p>
                                            </div>
                                            {loading[client.id] && (
                                                <Sparkles className="animate-spin" color="#667eea" />
                                            )}
                                        </div>

                                        {/* Message Area */}
                                        {messages[client.id] ? (
                                            <div>
                                                {editingId === client.id ? (
                                                    <textarea
                                                        value={messages[client.id]}
                                                        onChange={(e) => handleEditMessage(client.id, e.target.value)}
                                                        style={{
                                                            width: '100%',
                                                            minHeight: '100px',
                                                            padding: '1rem',
                                                            borderRadius: '12px',
                                                            border: '2px solid #667eea',
                                                            fontSize: '1rem',
                                                            fontFamily: 'inherit',
                                                            resize: 'vertical',
                                                            marginBottom: '1rem'
                                                        }}
                                                    />
                                                ) : (
                                                    <div style={{
                                                        background: '#f7f9fc',
                                                        padding: '1.25rem',
                                                        borderRadius: '12px',
                                                        marginBottom: '1rem',
                                                        lineHeight: '1.6',
                                                        color: '#444',
                                                        fontSize: '1rem'
                                                    }}>
                                                        {messages[client.id]}
                                                    </div>
                                                )}

                                                {/* Action Buttons */}
                                                <div style={{
                                                    display: 'flex',
                                                    gap: '1rem'
                                                }}>
                                                    {editingId === client.id ? (
                                                        <button
                                                            onClick={() => setEditingId(null)}
                                                            style={{
                                                                flex: 1,
                                                                background: '#764ba2',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '12px',
                                                                padding: '0.875rem',
                                                                cursor: 'pointer',
                                                                fontWeight: '600',
                                                                fontSize: '1rem',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                gap: '0.5rem',
                                                                transition: 'all 0.2s'
                                                            }}
                                                        >
                                                            Done Editing
                                                        </button>
                                                    ) : (
                                                        <>
                                                            <button
                                                                onClick={() => setEditingId(client.id)}
                                                                style={{
                                                                    flex: 1,
                                                                    background: 'white',
                                                                    color: '#667eea',
                                                                    border: '2px solid #667eea',
                                                                    borderRadius: '12px',
                                                                    padding: '0.875rem',
                                                                    cursor: 'pointer',
                                                                    fontWeight: '600',
                                                                    fontSize: '1rem',
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    justifyContent: 'center',
                                                                    gap: '0.5rem',
                                                                    transition: 'all 0.2s'
                                                                }}
                                                            >
                                                                <Edit3 size={18} />
                                                                Edit Message
                                                            </button>
                                                            <button
                                                                onClick={() => handleSendMessage(client)}
                                                                style={{
                                                                    flex: 1,
                                                                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '12px',
                                                                    padding: '0.875rem',
                                                                    cursor: 'pointer',
                                                                    fontWeight: '600',
                                                                    fontSize: '1rem',
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    justifyContent: 'center',
                                                                    gap: '0.5rem',
                                                                    transition: 'all 0.2s'
                                                                }}
                                                            >
                                                                <Send size={18} />
                                                                Send Message
                                                            </button>
                                                        </>
                                                    )}
                                                </div>
                                            </div>
                                        ) : (
                                            <div style={{
                                                textAlign: 'center',
                                                padding: '2rem',
                                                color: '#888'
                                            }}>
                                                Generating personalized message...
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div style={{
                                background: 'rgba(255, 255, 255, 0.98)',
                                borderRadius: '20px',
                                padding: '3rem',
                                textAlign: 'center',
                                boxShadow: '0 10px 40px rgba(0, 0, 0, 0.2)'
                            }}>
                                <Calendar size={60} color="#ccc" style={{ marginBottom: '1rem' }} />
                                <h3 style={{ color: '#555', fontSize: '1.25rem', margin: 0 }}>
                                    No birthdays today
                                </h3>
                                <p style={{ color: '#888', marginTop: '0.5rem' }}>
                                    {clients.length > 0 
                                        ? 'Check back tomorrow!' 
                                        : 'Upload your client data to get started'}
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BirthdayReminderApp />);
    </script>
</body>
</html>